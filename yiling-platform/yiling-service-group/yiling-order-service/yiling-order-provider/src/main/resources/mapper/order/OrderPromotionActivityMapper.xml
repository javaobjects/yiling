<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yiling.order.order.dao.OrderPromotionActivityMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.yiling.order.order.entity.OrderPromotionActivityDO">
    <result column="id" property="id" />
        <result column="order_id" property="orderId" />
        <result column="activity_id" property="activityId" />
        <result column="activity_name" property="activityName" />
        <result column="activity_desc" property="activityDesc" />
        <result column="activity_type" property="activityType" />
        <result column="activity_bear" property="activityBear" />
        <result column="sponsor_type" property="sponsorType" />
        <result column="activity_platform_percent" property="activityPlatformPercent" />
        <result column="activity_num" property="activityNum" />
        <result column="del_flag" property="delFlag" />
        <result column="create_user" property="createUser" />
        <result column="create_time" property="createTime" />
        <result column="update_user" property="updateUser" />
        <result column="update_time" property="updateTime" />
        <result column="remark" property="remark" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id,
        order_id, activity_id, activity_name, activity_desc, activity_type, activity_bear,sponsor_type,activity_platform_percent,activity_num,del_flag, create_user, create_time, update_user, update_time, remark
    </sql>

    <select id="sumOrderPromotionActivity" resultType="long">
        SELECT IFNULL(SUM(ac.`activity_num`), 0)
        FROM `order` so INNER JOIN `order_promotion_activity` ac ON so.`id` = ac.`order_id`
        WHERE so.`order_type` = 2 and so.`order_source`  = 3
        AND ac.`activity_id` = #{request.activityId}
        <if test="request.activityType != null and request.activityType != 0">
            AND ac.`activity_type` = #{request.activityType}
        </if>
        <if test="request.buyerEid != null and request.buyerEid != 0">
            AND so.`buyer_eid` = #{request.buyerEid}
        </if>
        <if test="request.startTime != null ">
            AND so.`create_time` <![CDATA[ >= ]]> #{request.startTime}
        </if>
        <if test="request.endTime != null ">
            AND so.`create_time` <![CDATA[ <= ]]> #{request.endTime}
        </if>
    </select>
</mapper>
